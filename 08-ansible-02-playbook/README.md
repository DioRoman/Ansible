# Домашнее задание к занятию 2 «Работа с Playbook»

## Подготовка к выполнению

1. * Необязательно. Изучите, что такое [ClickHouse](https://www.youtube.com/watch?v=fjTNS2zkeBs) и [Vector](https://www.youtube.com/watch?v=CgEhyffisLY).
2. Создайте свой публичный репозиторий на GitHub с произвольным именем или используйте старый.
3. Скачайте [Playbook](./playbook/) из репозитория с домашним заданием и перенесите его в свой репозиторий.
4. Подготовьте хосты в соответствии с группами из предподготовленного playbook.

## Основная часть

1. Подготовьте свой inventory-файл `prod.yml`.

  _Создаем VM в YC_

  https://github.com/DioRoman/ter_vm_dev

3. Допишите playbook: нужно сделать ещё один play, который устанавливает и настраивает [vector](https://vector.dev). Конфигурация vector должна деплоиться через template файл jinja2. От вас не требуется использовать все возможности шаблонизатора, просто вставьте стандартный конфиг в template файл. Информация по шаблонам по [ссылке](https://www.dmosk.ru/instruktions.php?object=ansible-nginx-install). не забудьте сделать handler на перезапуск vector в случае изменения конфигурации!
4. При создании tasks рекомендую использовать модули: `get_url`, `template`, `unarchive`, `file`.
5. Tasks должны: скачать дистрибутив нужной версии, выполнить распаковку в выбранную директорию, установить vector.

  https://github.com/DioRoman/08-ansible-02-playbook/blob/main/playbook/vector.yml
  
5. Запустите `ansible-lint site.yml` и исправьте ошибки, если они есть.

![Снимок экрана 2025-07-02 195539](https://github.com/user-attachments/assets/f2c8f0f7-ab4e-4b37-b7e3-ea414531a5f0)

6. Попробуйте запустить playbook на этом окружении с флагом `--check`.

`--check
Имитирует запуск плейбука без изменения данных. Ansible выполняет те же проверки, что и при обычном выполнении, но не вносит изменения в системы. Вместо этого он показывает, какие изменения были бы внесены, если бы плейбук был выполнен. `

7. Запустите playbook на `prod.yml` окружении с флагом `--diff`. Убедитесь, что изменения на системе произведены.

`  --diff
Позволяет отслеживать изменения в файлах на удалённых хостах. Если в файлах на удалённой системе изменены шаблоны, Ansible выводит текстовые изменения, внесённые в файл (или, если используется с --check, изменения, которые были бы внесены)`

8. Повторно запустите playbook с флагом `--diff` и убедитесь, что playbook идемпотентен.
9. Подготовьте README.md-файл по своему playbook. В нём должно быть описано: что делает playbook, какие у него есть параметры и теги. Пример качественной документации ansible playbook по [ссылке](https://github.com/opensearch-project/ansible-playbook). Так же приложите скриншоты выполнения заданий №5-8
10. Готовый playbook выложите в свой репозиторий, поставьте тег `08-ansible-02-playbook` на фиксирующий коммит, в ответ предоставьте ссылку на него.

![Снимок экрана 2025-07-02 195720](https://github.com/user-attachments/assets/958d492f-10cd-42ce-84f6-5ac6b1b96811)

![Снимок экрана 2025-07-02 195755](https://github.com/user-attachments/assets/2f3269c7-6f50-4d2d-8cc4-ffabad66a3af)


